int
countPrimes (int n)
{
    int i, j, cnt;
    uint8_t *flags;

    flags = calloc(n+1, sizeof(uint8_t));
    if (flags == NULL) {
        return -1;
    }
    memset(flags, 1, (n+1)*sizeof(uint8_t));

    flags[0] = 0;
    cnt = 1; // for prime 1

    for (i = 2; i*i < n; i++) {
        if (flags[i] != 1) {
            continue;
        }
        cnt++;
        for (j = 2; i*j <= n; j++) {
            flags[i*j] = 0;
        }
    }

    return cnt;
}

